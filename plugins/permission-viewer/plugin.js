(function(T,f,C,O,o,D){"use strict";function N(r){if(r&&r.__esModule)return r;var n=Object.create(null);return r&&Object.keys(r).forEach(function(a){if(a!=="default"){var i=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:function(){return r[a]}})}}),n.default=r,Object.freeze(n)}var e=N(T);const P=[];var d={patch:r=>r&&P.push(r),unpatchAll:()=>P.forEach(async r=>await r()),lazyPatchContextMenu:async(r,n)=>{const a=s=>s.default&&s.default.displayName===r,i=o.find(a);if(i)n(i);else{const s=o.findByProps("openContextMenuLazy");let t=f.before("openContextMenuLazy",s,l=>{const c=l[1];return l[1]=async()=>{const u=await c(l[0]);return B=>{const g=u(B);return g?.type?.displayName===r&&n&&(t(),n(o.find(a)),n=!1),g}},l})}}};const M=o.findByDisplayName("Flex"),R=o.findByDisplayName("Text"),h=o.findByDisplayName("TabBar"),A=o.findByDisplayName("Close"),b=o.findByDisplayName("Checkmark"),E=o.findByProps("ModalCloseButton"),{Permissions:m}=O.constants,y={TabBar:o.findByProps("tabBarContainer"),ReactionModal:o.findByProps("spinnerMore"),RoleMenu:o.findByProps("roleDot","sidebar")};var x=({event:r,roles:n={},permissions:a})=>{const[i,s]=e.useState(Object.keys(n)[0]);return e.createElement(E.ModalRoot,{transitionState:r.transitionState,className:y.ReactionModal.container,size:"large"},e.createElement(D.ErrorBoundary,null,a||e.createElement(E.ModalContent,null,e.createElement(h,{selectedItem:i,type:h.Types.SIDE,onItemSelect:s},Object.keys(n).map(t=>e.createElement(h.Item,{id:n[t].id,className:y.RoleMenu.row,itemType:h.Types.SIDE},e.createElement("div",{className:y.RoleMenu.roleDot,style:{backgroundColor:n[t].colorString||"#99aab5"}}),e.createElement(R,{className:y.RoleMenu.roleName},n[t].name))))),e.createElement(E.ModalContent,null,Object.keys(m).map(t=>{const l=i?n[i].permissions:a,c=n?.[i]?.permissionsDeny,u=(l&m.ADMINISTRATOR)===m.ADMINISTRATOR;return e.createElement(M,{style:{paddingLeft:"12px",paddingRight:"264px"},align:M.Align.CENTER,className:y.ReactionModal.reactorDefault},e.createElement(M.Child,{grow:0,shrink:0},(l&m[t])===m[t]&&(c?(c&m[t])!==m[t]:!0)||u?e.createElement(b,{height:24,width:24,color:"#43B581"}):e.createElement(A,{height:24,width:24,color:"#F04747"})),e.createElement(M.Child,null,e.createElement(R,null,t.charAt(0).toUpperCase()+t.slice(1).toLowerCase().replace(/_\w/g,B=>" "+B.toUpperCase().slice(1)))))}))))};const p=o.findByProps("MenuGroup","MenuItem"),{Permissions:j}=O.constants,{getGuild:v}=o.findByProps("getGuild"),{getMember:z}=o.findByProps("getMember"),{openModal:I}=o.findByProps("openModal","openModalLazy"),S=()=>{d.lazyPatchContextMenu("GuildContextMenu",r=>{d.patch(f.after("default",r,([n],a)=>{C.findInReactTree(a,s=>Array.isArray(s.children))?.children?.splice(1,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{I(s=>e.createElement(x,{event:s,roles:n.guild.roles}))}})))}))})},L=()=>{d.lazyPatchContextMenu("GuildChannelUserContextMenu",r=>{d.patch(f.after("default",r,([n],a)=>{const i=C.findInReactTree(a,c=>Array.isArray(c.children))?.children,s=v(n.guildId),t=z(n.guildId,n.user.id),l=s.ownerId===n.user.id?Object.values(j).reduce((c,u)=>c|u,0n):Object.values(s.roles).reduce((c,u)=>~t.roles.indexOf(u.id)?c|u.permissions:c,0n|s.roles[n.guildId].permissions);i?.splice(2,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{I(c=>e.createElement(x,{event:c,permissions:l}))}})))}))})},G=()=>{d.lazyPatchContextMenu("ChannelListTextChannelContextMenu",r=>{d.patch(f.after("default",r,([n],a)=>{const i=C.findInReactTree(a,t=>Array.isArray(t.children))?.children,s=Object.values(n.guild.roles).map(t=>{if(!~Object.keys(n.channel.permissionOverwrites).indexOf(t.id))return;const l={...t};return l.permissions|=n.channel.permissionOverwrites[t.id].allow,l.permissionsDeny=n.channel.permissionOverwrites[t.id].deny,l}).filter(Boolean).reduce((t,l)=>Object.assign(t,{[l.id]:l}),{});i?.splice(1,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{I(t=>e.createElement(x,{event:t,roles:s}))}})))}))})};var _=()=>({onLoad(){S(),L(),G()},onUnload(){d.unpatchAll()}});return _})(cumcord.modules.common.React,cumcord.patcher,cumcord.utils,cumcord.modules.common,cumcord.modules.webpack,cumcord.ui.components);
