(function(Z,f,t,g,q,y,n){"use strict";function K(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(o){if(o!=="default"){var a=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(r,o,a.get?a:{enumerable:!0,get:function(){return e[o]}})}}),r.default=e,Object.freeze(r)}var s=K(Z),W=()=>g.injectCSS(".reaction-notifications-body{display:grid;grid-gap:12px;padding:8px 20px;align-items:center;border-radius:0;grid-template-columns:32px auto 40px}.reaction-notifications-username{flex-grow:1;cursor:pointer;font-weight:500;text-overflow:ellipsis;color:var(--text-normal)}.reaction-notifications-container{position:relative;background-color:var(--background-primary)}.reaction-notifications-message{padding:16px 16px 4px 0}.reaction-notifications-username:hover{text-decoration:underline}.reaction-notifications-first-message{border-radius:8px 8px 0 0}.reaction-notifications-last-reaction{border-radius:0 0 8px 8px}");n.findByDisplayName("Text");const J=n.findByDisplayName("Slider"),S=n.findByProps("DropdownSizes"),X=n.findByDisplayName("Divider");n.findByDisplayName("FormText");const Y=n.findByDisplayName("Speaker"),Q=n.findByDisplayName("TextInput"),h=n.findByDisplayName("FormTitle"),m=n.findByDisplayName("SwitchItem"),C=n.findByProps("soundRow");var w=()=>(f.useNest(t.persist),s.createElement(s.Fragment,null,s.createElement(h,null,"INBOX"),s.createElement(m,{onChange:()=>t.persist.store.disableInbox=!t.persist.ghost.disableInbox,value:t.persist.ghost.disableInbox,hideBorder:!0},"Disable recent reactions in inbox (requires reload)"),s.createElement(m,{note:"Add reactions to the inbox even if the reaction is from the current channel.",onChange:()=>t.persist.store.addFromCurrent=!t.persist.ghost.addFromCurrent,value:t.persist.ghost.addFromCurrent,disabled:t.persist.ghost.disableInbox},"Add to inbox from current channel"),s.createElement(h,null,"MESSAGE CACHING"),s.createElement(m,{note:"Will log every message ID sent from you so the plugin can manually request the message if it isn't cached.",onChange:()=>t.persist.store.enableMessageCache=!t.persist.ghost.enableMessageCache,value:t.persist.ghost.enableMessageCache,hideBorder:!0},"Enable Forced Message Cache"),s.createElement(S,{color:S.Colors.BRAND_NEW,size:S.Sizes.MEDIUM,onClick:()=>t.persist.store.messageStore={}},"Clear Message Cache (",Object.keys(t.persist.ghost.messageStore).reduce((e,r)=>e+=t.persist.ghost.messageStore[r].length,0),")"),s.createElement("div",{style:{paddingBottom:"20px"}}),s.createElement(X,null),s.createElement(h,null,"NOTIFICATIONS"),s.createElement(m,{onChange:()=>t.persist.store.disableNotifications=!t.persist.ghost.disableNotifications,value:t.persist.ghost.disableNotifications,hideBorder:!0},"Disable notifications"),s.createElement(m,{onChange:()=>t.persist.store.sendInDND=!t.persist.ghost.sendInDND,value:t.persist.ghost.sendInDND,disabled:t.persist.ghost.disableNotifications,hideBorder:!0},"Send notifications while in DND mode"),s.createElement(m,{note:"Send notifications even if the reaction is from the current channel.",onChange:()=>t.persist.store.sendInCurrent=!t.persist.ghost.sendInCurrent,value:t.persist.ghost.sendInCurrent,disabled:t.persist.ghost.disableNotifications},"Send notifications from the current channel"),s.createElement(h,{className:`${C.notificationSound} ${C.soundRow}`},"AUDIO",s.createElement("div",{className:C.soundIcon,onClick:()=>{if(!t.persist.ghost.createSound)return;const e="https://discord.com/assets/dd920c06a01e5bb8b09678581e29d56f.mp3",r=new Audio(t.persist.ghost.mentionSound?e:t.persist.ghost.link);r.volume=t.persist.ghost.volume,r.play()}},s.createElement(Y,{width:15,height:24}))),s.createElement(m,{note:'Psst! You can preview the sound by hovering over "Audio" and clicking on the speaker!',onChange:()=>t.persist.store.createSound=!t.persist.ghost.createSound,value:t.persist.ghost.createSound,hideBorder:!0},"Create sound on notification"),s.createElement(m,{onChange:()=>t.persist.store.mentionSound=!t.persist.ghost.mentionSound,value:t.persist.ghost.mentionSound,disabled:!t.persist.ghost.createSound,hideBorder:!0},"Use default mention sound"),s.createElement(h,null,"AUDIO LINK"),s.createElement(Q,{placeholder:"https://cdn.discordapp.com/attachments/829809799553482764/847584766148345866/society.mp3",className:"codeRedemptionInput-fKM0fu",onChange:e=>t.persist.store.link=e,disabled:t.persist.ghost.mentionSound||!t.persist.ghost.createSound,value:t.persist.ghost.link}),s.createElement("div",{style:{paddingBottom:"20px"}}),s.createElement(h,null,"VOLUME (DEFAULT IS 100%)"),s.createElement(J,{initialValue:t.persist.ghost.volume*100,minValue:0,maxValue:100,disabled:!t.persist.ghost.createSound,onValueChange:e=>t.persist.store.volume=e/100}),s.createElement("div",{style:{paddingBottom:"20px"}})));const x=[];var u={patch:e=>e&&x.push(e),unpatchAll:()=>x.forEach(e=>e())};const R=n.findByDisplayName("Text"),k=n.findByDisplayName("Reactions"),D=n.findByDisplayNameAll("Header")[1],I=n.find(e=>e.prototype?.getGuildId),ee=n.findByDisplayName("Checkmark"),A=n.findByDisplayName("FormDivider"),P=n.findByProps("AnimatedAvatar").default,te=n.findByDisplayName("CircleIconButton"),B=n.findByProps("MenuGroup","MenuItem"),se=n.findByDisplayNameAll("EmojiSmile")[1],ne=n.findByDisplayName("InboxEmptyStateStars"),T=n.find(e=>e.prototype?.toDate&&e.prototype.month),oe=n.findByDisplayName("RecentsChannelHeader"),N=n.find(e=>e.type?.displayName==="ChannelMessage"),F=n.find(e=>e.prototype?.getReaction&&e.prototype.isSystemDM),{transitionTo:O}=n.findByProps("transitionTo"),{openUserProfileModal:j}=n.findByProps("openUserProfileModal"),{openContextMenu:re,closeContextMenu:ie}=n.findByProps("openContextMenu"),c={Sizes:n.findByProps("size10"),Button:n.findByProps("size32"),Stars:n.findByProps("stars","protip"),Colors:n.findByProps("colorStatusGreen")},U=()=>s.createElement("div",{className:"reaction-notifications-container",style:{borderRadius:"8px",marginTop:"8px",marginLeft:"16px"}},s.createElement(N,{channel:new I({id:"uwu"}),message:new F({content:"rape",timestamp:new T("2021-09-24T22:20:42.723Z"),author:{id:"192760945766957066",username:"creatable",toString:()=>"creatable",isSystemUser:()=>!1,getAvatarURL:()=>"https://cdn.discordapp.com/avatars/192760945766957066/629d2de47aab4d95fe45d846abfb083a.webp?size=80"}}),style:{paddingTop:"8px",marginLeft:"4px",textAlign:"left",marginRight:"132px"}}),s.createElement(N,{channel:new I({id:"uwu"}),message:new F({content:"LMAO",timestamp:new T("2021-09-24T22:20:42.723Z"),author:{id:"257109471589957632",username:"Beef",toString:()=>"Beef",isSystemUser:()=>!1,getAvatarURL:()=>"https://cdn.discordapp.com/avatars/257109471589957632/d1edbec71d56736a68bc639ed7da43d0.webp?size=80"}}),style:{marginLeft:"4px",textAlign:"left",paddingBottom:"8px"}}));var p={RapeLMAO:U,NoReactions:()=>s.createElement("div",{className:c.Stars.container},s.createElement("div",{className:c.Stars.iconContainer},s.createElement(se,{className:c.Stars.icon,width:36,height:36}),s.createElement(ne,{className:c.Stars.stars})),s.createElement(D,{className:c.Stars.header,size:c.Sizes.size24},"No reactions here!"),s.createElement(R,{className:c.Colors.colorHeaderSecondary,size:c.Sizes.size12},s.createElement(R,{tag:"span",className:c.Stars.protip,color:c.Colors.colorStatusGreen,size:c.Sizes.size12},"Protip:"," "),Math.random()<.1?s.createElement(U,null):"Cumming is always funner with friends!")),ReactionCardHeader:e=>s.createElement(oe,{channel:e.channel,gotoChannel:()=>{O(`/channels/${e.channel.guildId||"@me"}/${e.channel.id}/${e.message}`)}},s.createElement(te,{className:`${c.Button.button} ${c.Button.tertiary}`,onClick:()=>delete t.persist.store.reactions[e.channel.id],tooltip:"Mark as Read",icon:s.createElement(ee,{height:16,width:16})})),RenderMessage:e=>s.createElement(s.Fragment,null,e.isFirstMessage||s.createElement(A,null),s.createElement("div",{className:`reaction-notifications-message ${!e.isFirstMessage||"reaction-notifications-first-message"} reaction-notifications-container`},s.createElement(N,{message:e.message,channel:e.channel,onContextMenu:r=>re(r,()=>s.createElement(s.Fragment,null,s.createElement(B.default,{onClose:ie},s.createElement(B.MenuItem,{label:"Jump to Message",id:"jump",action:()=>{O(`/channels/${e.channel.guildId||"@me"}/${e.channel.id}/${e.message.id}`)}}),s.createElement(B.MenuItem,{label:"Delete Message",id:"delete",action:()=>{delete t.persist.store.reactions[e.channel.id][e.message.id]}}))))}))),ReactionCardBody:e=>s.createElement(s.Fragment,null,s.createElement(A,null),s.createElement("div",{className:`reaction-notifications-body ${!e.isLastReaction||"reaction-notifications-last-reaction"} reaction-notifications-container`},s.createElement(P,{src:e.user.getAvatarURL(),size:P.Sizes.SIZE_32,onClick:()=>j({userId:e.user.id})}),s.createElement("div",{className:"reaction-notifications-username",onClick:()=>j({userId:e.user.id})},e.user.username,"#",e.user.discriminator),s.createElement("div",{className:"reaction-notifications-reactions"},s.createElement(k,{channel:new I({id:"uwu"}),message:{getChannelId:()=>"uwu!",reactions:[{count:e.count,emoji:e.reaction.emoji,me:!1}]},disableReactionCreates:!0,disableReactionUpdates:!0}))))};const{getGuild:ae}=n.findByProps("getGuild"),{getChannel:ce}=n.findByProps("getDMUserIds"),{fetchMessages:de}=n.findByProps("sendMessage"),{transitionTo:le}=n.findByProps("transitionTo"),{getChannelId:_}=n.findByProps("getVoiceChannelId"),{showNotification:me}=n.findByProps("showNotification"),{getStatus:he}=n.findByProps("getStatus","getPresence"),{getMessage:$}=n.findByProps("getMessage","getMessages"),{AdvancedScrollerThin:ue}=n.findByProps("AdvancedScrollerThin"),{getUser:fe,getCurrentUser:ge}=n.findByProps("getUser","getCurrentUser"),ye=n.findByProps("Header","Item"),v=n.findByProps("getFullState","settings"),z=n.find(e=>e.default?.displayName==="RecentsHeader"),pe=n.find(e=>e.default?.displayName==="RecentMentions"),Ee=n.find(e=>e.default?.displayName==="UnreadMessages"),M={...n.findByProps("tab","header"),...n.findByProps("messageContainer")},Se=(e,r)=>({channelId:e,jump:{flash:!0,messageId:r},limit:1}),L=async e=>{const r=ge().id;if(e?.userId!==r){let o=$(e.channelId,e.messageId);if(!o&&t.persist.ghost.enableMessageCache&&t.persist.ghost.messageStore[e.channelId]?.includes(e.messageId)&&(await de(Se(e.channelId,e.messageId)),await new Promise(a=>setTimeout(a,300)),o=$(e.channelId,e.messageId)),o?.author.id===r){const a=fe(e.userId),i=ce(e.channelId),d=ae(i.guild_id);if((t.persist.ghost.addFromCurrent||_()!==i.id)&&(t.persist.ghost.disableInbox||(t.persist.ghost.reactions[i.id]||(t.persist.store.reactions[i.id]={channel:i}),t.persist.ghost.reactions[i.id][o.id]||(t.persist.store.reactions[i.id][o.id]=[o]),t.persist.store.reactions[i.id][o.id].push({reaction:e,guild:d,user:a,message:o,channel:i,count:o.reactions.find(l=>l.emoji.name===e.emoji.name&&l.emoji.id===e.emoji.id).count}))),t.persist.ghost.disableNotifications)return;if((t.persist.ghost.sendInCurrent||_()!==i.id)&&(t.persist.ghost.sendInDND||he(r)!=="dnd")&&(me(a.getAvatarURL(),`${a.username}${d?` (#${i.name}, ${d.name})`:""}`,`New Reaction: ${e.emoji.name}`,{onClick:()=>le(path)}),t.persist.ghost.createSound)){const l="https://discord.com/assets/dd920c06a01e5bb8b09678581e29d56f.mp3",E=new Audio(t.persist.ghost.mentionSound?l:t.persist.ghost.link);E.volume=t.persist.ghost.volume,E.play()}}}},H=e=>{!t.persist.ghost.enableMessageCache||!e.sendMessageOptions||e.optimistic||(t.persist.ghost.messageStore[e.channelId]||(t.persist.store.messageStore[e.channelId]=[]),t.persist.store.messageStore[e.channelId].push(e.message.id))},G=()=>{const e=t.persist.ghost.reactions,r=[[]];return f.useNest(t.persist),Object.keys(e).forEach((o,a)=>{if(r[a]||r.push([]),Object.keys(e[o]).length===1){delete e[o];return}r[a].push(s.createElement(p.ReactionCardHeader,{channel:e[o].channel,message:e[o][Object.keys(e[o])[1]][0].id})),Object.keys(e[o]).forEach((i,d,l)=>{if(i==="channel")return;const E=d===1,Ne=d===l.length-1;r[a].push(s.createElement(p.RenderMessage,{isFirstMessage:E,message:e[o][i][0],channel:e[o].channel})),e[o][i].forEach((ve,V,b)=>{if(V===0)return;b.length===1&&delete e[o][i];const Me=Ne&&(b.length===1||V===b.length-1);r[a].push(s.createElement(p.ReactionCardBody,{...ve,isLastReaction:Me}))})})}),s.createElement(q.ErrorBoundary,null,s.createElement(ue,{fade:!0},r[0].length?r.map(o=>s.createElement("div",{className:M.container},o)):s.createElement(p.NoReactions,null)))},Ce=()=>{const e=({__originalType:r,...o})=>{const a=r.call(void 0,o);try{v.settings.inbox.currentTab===3&&(a.props.children[1]=s.createElement(G,null))}catch(i){console.error("RecentMentions patch failed:",i)}return a};u.patch(g.after("default",pe,(r,o)=>{Object.assign(o.props,{__originalType:o.type}),o.type=e})),u.patch(g.after("default",Ee,(r,o)=>{v.settings.inbox.currentTab===3&&(o.props.children[1]=s.createElement(G,null))}))},Ie=()=>{const e=({__originalType:r,...o})=>{const a=r.call(void 0,o);if(o.tab!==3)return a;try{const i=f.findInReactTree(a,d=>typeof d?.onClick=="function");if(!i)return a;i.onClick=()=>t.persist.store.reactions={}}catch(i){console.error("ReadAllButton patch failed:",i)}return a};u.patch(g.before("default",z,([r])=>{r.tab=v.settings.inbox.currentTab})),u.patch(g.after("default",z,([r],o)=>{const a=f.findInReactTree(o,l=>l?.onItemSelect),i=f.findInReactTree(o,l=>typeof l?.props?.onClick=="function"),d=a?.children;!Array.isArray(d)||(i&&(Object.assign(i.props,{__originalType:i.type,tab:r.tab}),i.type=e),d.push(s.createElement(ye.Item,{id:3,look:0,className:`${M.tab}${r.tab===3?` ${M.active}`:""}`},"Reactions")))}))};var Be=()=>({onLoad(){t.persist.ghost.reactions||(t.persist.store.reactions={}),t.persist.ghost.messageStore||(t.persist.store.messageStore={});const e={link:"",volume:1,createSound:!0,mentionSound:!0,sendInCurrent:!0};for(let r in e)t.persist.ghost.hasOwnProperty(r)||(t.persist.store[r]=e[r]);y.FluxDispatcher.subscribe("MESSAGE_CREATE",H),y.FluxDispatcher.subscribe("MESSAGE_REACTION_ADD",L),t.persist.ghost.disableInbox||(u.patch(W()),Ce(),Ie())},onUnload(){y.FluxDispatcher.unsubscribe("MESSAGE_CREATE",H),y.FluxDispatcher.unsubscribe("MESSAGE_REACTION_ADD",L),u.unpatchAll()},settings:s.createElement(w,null)});return Be})(cumcord.modules.common.React,cumcord.utils,cumcord.pluginData,cumcord.patcher,cumcord.ui.components,cumcord.modules.common,cumcord.modules.webpack);
